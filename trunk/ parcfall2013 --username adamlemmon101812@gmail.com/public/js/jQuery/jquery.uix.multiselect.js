/*
 * jQuery UIx Multiselect 2.0
 *
 * Authors:
 *  Yanick Rochon (yanick.rochon[at]gmail[dot]com)
 *
 * Licensed under the MIT (MIT-LICENSE.txt) license.
 *
 * http://mind2soft.com/labs/jquery/multiselect/
 *
 *
 * Depends:
 * jQuery UI 1.8+
 *
 */

;(function($,q){var r=0;var u='';var w='group-';var z='multiselectChange';var A='multiselectSearch';$.widget("uix.multiselect",{options:{availableListPosition:'right',collapsableGroups:true,defaultGroupName:'',filterSelected:false,locale:'auto',moveEffect:null,moveEffectOptions:{},moveEffectSpeed:null,optionRenderer:false,searchField:'toggle',searchHeader:'available',selectionMode:'click,d&d',showDefaultGroupHeader:false,showEmptyGroups:false,splitRatio:0.55,sortable:false,sortMethod:null},_create:function(){var a=this;var b,selListContent,avListHeader,avListContent;var c,btnDeselectAll;this.scope='multiselect'+(r++);this.optionGroupIndex=1;this._setLocale(this.options.locale);this.element.addClass('uix-multiselect-original');this._elementWrapper=$('<div></div>').addClass('uix-multiselect ui-widget').css({'width':this.element.outerWidth(),'height':this.element.outerHeight()}).append($('<div></div>').addClass('multiselect-selected-list').append($('<div></div>').addClass('ui-widget-header').append(btnDeselectAll=$('<button></button>',{type:"button"}).addClass('uix-control-right').attr('data-localekey','deselectAll').attr('title',this._t('deselectAll')).button({icons:{primary:'ui-icon-arrowthickstop-1-e'},text:false}).click(function(e){e.preventDefault();e.stopPropagation();a.optionCache.setSelectedAll(false);return false})).append(b=$('<div></div>').addClass('header-text'))).append(selListContent=$('<div></div>').addClass('uix-list-container ui-widget-content')))['right,top'.indexOf(this.options.availableListPosition)>=0?'prepend':'append']($('<div></div>').addClass('multiselect-available-list').append($('<div></div>').addClass('ui-widget-header').append(c=$('<button></button>',{type:"button"}).addClass('uix-control-right').attr('data-localekey','selectAll').attr('title',this._t('selectAll')).button({icons:{primary:'ui-icon-arrowthickstop-1-w'},text:false}).click(function(e){e.preventDefault();e.stopPropagation();a.optionCache.setSelectedAll(true);return false})).append(avListHeader=$('<div></div>').addClass('header-text'))).append(avListContent=$('<div></div>').addClass('uix-list-container ui-widget-content'))).insertAfter(this.element);this._buttons={'selectAll':c,'deselectAll':btnDeselectAll};this._headers={'selected':b,'available':avListHeader};this._lists={'selected':selListContent.attr('id',this.scope+'_selListContent'),'available':avListContent.attr('id',this.scope+'_avListContent')};this.optionCache=new I(this);this._searchDelayed=new G(this,{delay:500});this._initSearchable();this._applyListDroppable();this.refresh()},refresh:function(d){this._resize();F(function(){this.optionCache.cleanup();var a,options=this.element[0].childNodes;for(var i=0,l1=options.length;i<l1;i++){a=options[i];if(a.nodeType==1){if(a.tagName.toUpperCase()=='OPTGROUP'){var b=$(a).data('option-group')||(w+(this.optionGroupIndex++));var c=a.childNodes;this.optionCache.prepareGroup($(a),b);for(var j=0,l2=c.length;j<l2;j++){a=c[j];if(a.nodeType==1){this.optionCache.prepareOption($(a),b)}}}else{this.optionCache.prepareOption($(a))}}}this.optionCache.reIndex();if(this._searchField&&this._searchField.is(':visible')){this._search(null,true)}if(d)d()},10,this)},search:function(a){if(typeof a!='object'){a={showInput:true,text:a}}if((a.toggleInput!=false)&&!this._searchField.is(':visible')){this._buttons.search.trigger('click')}this._search(a.text,!!a.silent)},locale:function(a){if(a==q){return this.options.locale}else{this._setLocale(a);this._updateControls();this._updateHeaders()}},destroy:function(){this._super();this.optionCache.reset(true);this._lists['selected'].empty().remove();this._lists['available'].empty().remove();this._elementWrapper.empty().remove();delete this.optionCache;delete this._searchDelayed;delete this._lists;delete this._elementWrapper;this.element.removeClass('uix-multiselect-original')},_initSearchable:function(){var a=('toggle'===this.options.searchField);var c=this.options.searchHeader;if(a){var d=this;this._buttons['search']=$('<button></button',{type:"button"}).addClass('uix-control-right').attr('data-localekey','search').attr('title',this._t('search')).button({icons:{primary:'ui-icon-search'},text:false}).click(function(e){e.preventDefault();e.stopPropagation();if(d._searchField.is(':visible')){var b=$(this);d._headers[c].css('visibility','visible').fadeTo('fast',1.0);d._searchField.hide('slide',{direction:'right'},200,function(){b.removeClass('ui-corner-right ui-state-active').addClass('ui-corner-all')});d._searchDelayed.cancelLastRequest();d.optionCache.filter('')}else{d._headers[c].fadeTo('fast',0.1,function(){$(this).css('visibility','hidden')});$(this).removeClass('ui-corner-all').addClass('ui-corner-right ui-state-active');d._searchField.show('slide',{direction:'right'},200,function(){$(this).focus()});d._search()}return false}).insertBefore(this._headers[c])}if(this.options.searchField){if(!a){this._headers[c].hide()}this._searchField=$('<input type="text" />').addClass('uix-search ui-widget-content ui-corner-'+(a?'left':'all'))[a?'hide':'show']().insertBefore(this._headers[c]).focus(function(){$(this).select()}).on("keydown keypress",function(e){if(e.keyCode==13){e.preventDefault();e.stopPropagation();return false}}).keyup($.proxy(this._searchDelayed.request,this._searchDelayed))}},_applyListDroppable:function(){if(this.options.selectionMode.indexOf('d&d')==-1)return;var f=this.optionCache;var g=this.scope;var h=function(d){return f._elements[d.data('element-index')]};var i=function(e,s){e.droppable({accept:function(a){var b=h(a);return b&&(b.selected!=s)},activeClass:'ui-state-highlight',scope:g,drop:function(a,b){b.draggable.removeClass('ui-state-disabled');b.helper.remove();f.setSelected(h(b.draggable),s)}})};i(this._lists['selected'],true);i(this._lists['available'],false);if(this.options.sortable){var j=this;this._lists['selected'].sortable({appendTo:'parent',axis:"y",containment:$('.multiselect-selected-list',this._elementWrapper),items:'.multiselect-element-wrapper',handle:'.group-element',revert:true,stop:$.proxy(function(b,c){var d;$('.multiselect-element-wrapper',j._lists['selected']).each(function(){var a=j.optionCache._groups.get($(this).data('option-group'));if(!d){j.element.append(a.groupElement)}else{a.groupElement.insertAfter(d.groupElement)}d=a})},this)})}},_search:function(a,b){if(this._searchField.is(':visible')){if(a){this._searchField.val(a)}else{a=this._searchField.val()}}else{a=(""+a)}this.optionCache.filter(a,b)},_setLocale:function(a){if(a=='auto'){a=navigator.userLanguage||navigator.language||navigator.browserLanguage||navigator.systemLanguage||''}if(!$.uix.multiselect.i18n[a]){a=''}this.options.locale=a},_t:function(a,b,c){return _({locale:this.options.locale,key:a,plural:b,data:c})},_updateControls:function(){var a=this;$('.uix-control-left,.uix-control-right',this._elementWrapper).each(function(){$(this).attr('title',a._t($(this).attr('data-localekey')))})},_updateHeaders:function(){var t,info=this.optionCache.getSelectionInfo();this._headers['selected'].text(t=this._t('itemsSelected',info.selected.total,{count:info.selected.total})).parent().attr('title',this.options.filterSelected?this._t('itemsSelected',info.selected.count,{count:info.selected.count})+", "+this._t('itemsFiltered',info.selected.filtered,{count:info.selected.filtered}):t);this._headers['available'].text(this._t('itemsAvailable',info.available.total,{count:info.available.total})).parent().attr('title',this._t('itemsAvailable',info.available.count,{count:info.available.count})+", "+this._t('itemsFiltered',info.available.filtered,{count:info.available.filtered}))},_resize:function(){var a=this.options.availableListPosition.toLowerCase();var b=('left,right'.indexOf(a)>=0)?'Width':'Height';var c=('left,right'.indexOf(a)>=0)?'Height':'Width';var d=this.element['outer'+b]()*this.options.splitRatio;var e=this.element['outer'+b]()-d;var f=(c==='Width')?d:this.element.outerHeight();var g=(c==='Width')?e:this.element.outerHeight();var i=('left,right'.indexOf(a)>=0)?'left':'top';var j=('left,top'.indexOf(a)>=0);var k=('toggle'===this.options.searchField);var l='ui-corner-tl ui-corner-tr ui-corner-bl ui-corner-br ui-corner-top';var m=(c==='Width')?(j?'':'ui-corner-top'):(j?'ui-corner-tr':'ui-corner-tl');var n=(c==='Width')?(j?'ui-corner-top':''):(j?'ui-corner-tl':'ui-corner-tr');this._elementWrapper.find('.multiselect-available-list')[b.toLowerCase()](e).css(i,j?0:d)[c.toLowerCase()](this.element['outer'+c]()+1);this._elementWrapper.find('.multiselect-selected-list')[b.toLowerCase()](d).css(i,j?e:0)[c.toLowerCase()](this.element['outer'+c]()+1);this._buttons['selectAll'].button('option','icons',{primary:E(a,'ui-icon-arrowthickstop-1-',false)});this._buttons['deselectAll'].button('option','icons',{primary:E(a,'ui-icon-arrowthickstop-1-',true)});this._headers['available'].parent().removeClass(l).addClass(n);this._headers['selected'].parent().removeClass(l).addClass(m);if(!k){var h=Math.max(this._headers['selected'].parent().height(),this._headers['available'].parent().height());this._headers['available'].parent().height(h);this._headers['selected'].parent().height(h)}if(this._searchField){this._searchField.width(this._headers['available'].parent().width()-(k?48:24))}this._lists['available'].height(g-this._headers['available'].parent().outerHeight()-2);this._lists['selected'].height(f-this._headers['selected'].parent().outerHeight()-2)},_triggerUIEvent:function(a,b){if(typeof a=='string'){a=$.Event(a)}this.element.trigger(a,b);return!a.isDefaultPrevented()},_setOption:function(a,b){switch(a){}if(typeof(this._superApply)=='function'){this._superApply(arguments)}else{$.Widget.prototype._setOption.apply(this,arguments)}}});var B={standard:function(a,b){if(a>b)return 1;if(a<b)return-1;return 0},natural:function naturalSort(a,b){var c=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,sre=/(^[ ]*|[ ]*$)/g,dre=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,hre=/^0x[0-9a-f]+$/i,ore=/^0/,i=function(s){return naturalSort.insensitive&&(''+s).toLowerCase()||''+s},x=i(a).replace(sre,'')||'',y=i(b).replace(sre,'')||'',xN=x.replace(c,'\0$1\0').replace(/\0$/,'').replace(/^\0/,'').split('\0'),yN=y.replace(c,'\0$1\0').replace(/\0$/,'').replace(/^\0/,'').split('\0'),xD=parseInt(x.match(hre))||(xN.length!=1&&x.match(dre)&&Date.parse(x)),yD=parseInt(y.match(hre))||xD&&y.match(dre)&&Date.parse(y)||null,oFxNcL,oFyNcL;if(yD)if(xD<yD)return-1;else if(xD>yD)return 1;for(var d=0,numS=Math.max(xN.length,yN.length);d<numS;d++){oFxNcL=!(xN[d]||'').match(ore)&&parseFloat(xN[d])||xN[d]||0;oFyNcL=!(yN[d]||'').match(ore)&&parseFloat(yN[d])||yN[d]||0;if(isNaN(oFxNcL)!==isNaN(oFyNcL)){return(isNaN(oFxNcL))?1:-1}else if(typeof oFxNcL!==typeof oFyNcL){oFxNcL+='';oFyNcL+=''}if(oFxNcL<oFyNcL)return-1;if(oFxNcL>oFyNcL)return 1}return 0}};var C=['n','e','s','w'];var D=['bottom','left','top','right'];var E=function(a,b,c){return b+C[($.inArray(a.toLowerCase(),D)+(c?2:0))%4]};var F=function(a,b,c){var d=Array.prototype.slice.call(arguments,3);return setTimeout(function(){a.apply(c||window,d)},b)};var G=function(a,b){this._widget=a;this._options=b;this._lastSearchValue=null};G.prototype={request:function(){if(this._widget._searchField.val()==this._lastSearchValue)return;this.cancelLastRequest();this._timeout=F(function(){this._timeout=null;this._lastSearchValue=this._widget._searchField.val();this._widget._search()},this._options.delay,this)},cancelLastRequest:function(){if(this._timeout){clearTimeout(this._timeout)}}};var H=function(h){var j=[];var k={};var l=h;this.setComparator=function(a){l=a;return this};this.clear=function(){j=[];k={};return this};this.containsKey=function(a){return!!k[a]};this.get=function(a){return k[a]};this.put=function(f,g){if(!k[f]){if(l){j.splice((function(){var d=0,high=j.length;var e=-1,c=0;while(d<high){e=parseInt((d+high)/2);var a=k[j[e]].groupElement;var b=g.groupElement;c=l(a?a.attr('label'):u,b?b.attr('label'):u);if(c<0){d=e+1}else if(c>0){high=e}else{return e}}return d})(),0,f)}else{j.push(f)}}k[f]=g;return this};this.remove=function(a){delete k[a];return j.splice(j.indexOf(a),1)};this.each=function(a){var b=Array.prototype.slice.call(arguments,1);b.splice(0,0,null,null);for(var i=0,len=j.length;i<len;i++){b[0]=j[i];b[1]=k[j[i]];a.apply(b[1],b)}return this}};var I=function(a){this._widget=a;this._listContainers={'selected':$('<div></div>').appendTo(this._widget._lists['selected']),'available':$('<div></div>').appendTo(this._widget._lists['available'])};this._elements=[];this._groups=new H();this._moveEffect={fn:a.options.moveEffect,options:a.options.moveEffectOptions,speed:a.options.moveEffectSpeed};this._selectionMode=this._widget.options.selectionMode.indexOf('dblclick')>-1?'dblclick':this._widget.options.selectionMode.indexOf('click')>-1?'click':false;this.reset()};I.Options={batchCount:200,batchDelay:50};I.prototype={_createGroupElement:function(c,d,f){var g=this;var j;var k=function(){if(!j)j=g._groups.get(d);return j};var l=function(){return c?c.attr('label'):g._widget.options.defaultGroupName};var m=$('<span></span>').addClass('label').text(l()+' (0)').attr('title',l()+' (0)');var n=function(){var a=k()[f?'selected':'available'];a.listElement[(!f&&(a.count||g._widget.options.showEmptyGroups))||(a.count&&((j.optionGroup!=u)||g._widget.options.showDefaultGroupHeader))?'show':'hide']();var t=l()+' ('+a.count+')';m.text(t).attr('title',t)};var e=$('<div></div>').addClass('ui-widget-header ui-priority-secondary group-element').append($('<button></button>',{type:"button"}).addClass('uix-control-right').attr('data-localekey',(f?'de':'')+'selectAllGroup').attr('title',this._widget._t((f?'de':'')+'selectAllGroup')).button({icons:{primary:E(this._widget.options.availableListPosition,'ui-icon-arrowstop-1-',f)},text:false}).click(function(e){e.preventDefault();e.stopPropagation();var a=k()[f?'selected':'available'];if(j.count>0){var b=[];g._bufferedMode(true);for(var i=j.startIndex,len=j.startIndex+j.count,eData;i<len;i++){eData=g._elements[i];if(!eData.filtered&&!eData.selected!=f){g.setSelected(eData,!f,true);b.push(eData.optionElement[0])}}g._updateGroupElements(j);g._widget._updateHeaders();g._bufferedMode(false);g._widget._triggerUIEvent(z,{optionElements:b,selected:!f})}return false})).append(m);var o,groupIcon=(c)?c.attr('data-group-icon'):null;if(this._widget.options.collapsableGroups){var p=(c)?c.attr('data-collapse-icon'):null,grpCollapseIcon=(p)?'ui-icon '+p:'ui-icon ui-icon-triangle-1-s';var h=$('<span></span>').addClass('ui-icon collapse-handle').attr('data-localekey','collapseGroup').attr('title',this._widget._t('collapseGroup')).addClass(grpCollapseIcon).mousedown(function(e){e.stopPropagation()}).click(function(e){e.preventDefault();e.stopPropagation();o(c);return false}).prependTo(e.addClass('group-element-collapsable'));o=function(a){var b=k()[f?'selected':'available'],p=(a)?a.attr('data-collapse-icon'):null,expandIconAttr=(a)?a.attr('data-expand-icon'):null,collapseIcon=(p)?'ui-icon '+p:'ui-icon ui-icon-triangle-1-s',expandIcon=(expandIconAttr)?'ui-icon '+expandIconAttr:'ui-icon ui-icon-triangle-1-e';b.collapsed=!b.collapsed;b.listContainer.slideToggle();h.removeClass(b.collapsed?collapseIcon:expandIcon).addClass(b.collapsed?expandIcon:collapseIcon)}}else{if(groupIcon){$('<span></span>').addClass('collapse-handle '+groupIcon).css('cursor','default').prependTo(e.addClass('group-element-collapsable'))}}return $('<div></div>').data('fnUpdateCount',n).data('fnToggle',o||$.noop).append(e)},_createGroupContainerElement:function(c,d,f){var g=this;var e=$('<div></div>');var h;if(this._widget.options.sortable&&f){e.sortable({tolerance:"pointer",appendTo:this._widget._elementWrapper,connectWith:this._widget._lists['available'].attr('id'),scope:this._widget.scope,helper:'clone',receive:function(a,b){var e=g._elements[h=b.item.data('element-index')];e.selected=true;e.optionElement.prop('selected',true);e.listElement.removeClass('ui-state-active')},stop:function(a,b){var e;if(h){e=g._elements[h];h=q;b.item.replaceWith(e.listElement.addClass('ui-state-highlight option-selected'));g._widget._updateHeaders();g._widget._triggerUIEvent(z,{optionElements:[e.optionElement[0]],selected:true})}else{e=g._elements[b.item.data('element-index')];if(e&&!e.selected){g._bufferedMode(true);g._appendToList(e);g._bufferedMode(false)}}if(e)g._reorderSelected(e.optionGroup)},revert:true})}if(this._selectionMode){$(e).on(this._selectionMode,'div.option-element',function(){var a=g._elements[$(this).data('element-index')];a.listElement.removeClass('ui-state-hover');g.setSelected(a,!f)})}return e},_createElement:function(c,d){var o=this._widget.options.optionRenderer?this._widget.options.optionRenderer(c,d):$('<div></div>').text(c.text());var f=c.attr("data-option-icon");var e=$('<div></div>').append(o).addClass('ui-state-default option-element').attr("unselectable","on").data('element-index',-1).hover(function(){if(c.prop('selected'))$(this).removeClass('ui-state-highlight');$(this).addClass('ui-state-hover')},function(){$(this).removeClass('ui-state-hover');if(c.prop('selected'))$(this).addClass('ui-state-highlight')});if(this._widget.options.selectionMode.indexOf('d&d')>-1){var g=this;e.draggable({addClasses:false,cancel:(this._widget.options.sortable?'.option-selected, ':'')+'.ui-state-disabled',appendTo:this._widget._elementWrapper,scope:this._widget.scope,start:function(a,b){$(this).addClass('ui-state-disabled ui-state-active');b.helper.width($(this).width()).height($(this).height())},stop:function(a,b){$(this).removeClass('ui-state-disabled ui-state-active')},helper:'clone',revert:'invalid',zIndex:99999,disabled:c.prop('disabled')});if(c.prop('disabled')){e.addClass('ui-state-disabled')}if(this._widget.options.sortable){e.draggable('option','connectToSortable',this._groups.get(d)['selected'].listContainer)}}else if(c.prop('disabled')){e[(c.prop('disabled')?"add":"remove")+"Class"]('ui-state-disabled')}if(f){e.addClass('grouped-option').prepend($('<span></span>').addClass('ui-icon '+f))}return e},_isOptionCollapsed:function(a){return this._groups.get(a.optionGroup)[a.selected?'selected':'available'].collapsed},_updateGroupElements:function(c){if(c){c['selected'].count=0;c['available'].count=0;for(var i=c.startIndex,len=c.startIndex+c.count;i<len;i++){c[this._elements[i].selected?'selected':'available'].count++}c['selected'].listElement.data('fnUpdateCount')();c['available'].listElement.data('fnUpdateCount')()}else{this._groups.each(function(k,a,b){b._updateGroupElements(a)},this)}},_appendToList:function(a){var b=this;var c=this._groups.get(a.optionGroup);var d=c[a.selected?'selected':'available'];if((a.optionGroup!=this._widget.options.defaultGroupName)||this._widget.options.showDefaultGroupHeader){d.listElement.show()}if(d.collapsed){d.listElement.data('fnToggle')()}else{d.listContainer.show()}var e=a.index-1;while((e>=c.startIndex)&&(this._elements[e].selected!=a.selected)){e--}if(e<c.startIndex){d.listContainer.prepend(a.listElement)}else{var f=this._elements[e].listElement;if(f.parent().hasClass('ui-effects-wrapper')){f=f.parent()}a.listElement.insertAfter(f)}a.listElement[(a.selected?'add':'remove')+'Class']('ui-state-highlight option-selected');if((a.selected||!a.filtered)&&!this._isOptionCollapsed(a)&&this._moveEffect&&this._moveEffect.fn){a.listElement.hide().show(this._moveEffect.fn,this._moveEffect.options,this._moveEffect.speed)}else if(a.filtered){a.listElement.hide()}},_reorderSelected:function(b){var e=this._elements;var g=this._groups.get(b);var c=g.groupElement?g.groupElement:this._widget.element;var d;$('.option-element',g['selected'].listContainer).each(function(){var a=e[$(this).data('element-index')].optionElement;if(!d){c.prepend(a)}else{a.insertAfter(d)}d=a})},_bufferedMode:function(a){if(a){this._oldMoveEffect=this._moveEffect;this._moveEffect=null;this._widget._lists['selected'].data('scrollTop',this._widget._lists['selected'].scrollTop());this._widget._lists['available'].data('scrollTop',this._widget._lists['available'].scrollTop());this._listContainers['selected'].detach();this._listContainers['available'].detach()}else{this._widget._lists['selected'].append(this._listContainers['selected']).scrollTop(this._widget._lists['selected'].data('scrollTop')||0);this._widget._lists['available'].append(this._listContainers['available']).scrollTop(this._widget._lists['available'].data('scrollTop')||0);this._moveEffect=this._oldMoveEffect;delete this._oldMoveEffect}},reset:function(a){this._groups.clear();this._listContainers['selected'].empty();this._listContainers['available'].empty();if(a){$.each(this._elements,function(i,e){e.optionElement.removeData('element-index')});delete this._elements;delete this._groups;delete this._listContainers}else{this._elements=[];this.prepareGroup();this._groups.setComparator(this.getComparator())}},cleanup:function(){var p=this._widget.element[0];var a=[];this._groups.each(function(g,v){if(v.groupElement&&!$.contains(p,v.groupElement[0])){a.push(g)}});for(var i=0,eData;i<this._elements.length;i++){eData=this._elements[i];if(!$.contains(p,eData.optionElement[0])||($.inArray(eData.optionGroup,a)>-1)){this._elements.splice(i--,1)[0].listElement.remove()}}for(var i=0,len=a.length;i<len;i++){this._groups.remove(a[i])}this.prepareGroup()},getComparator:function(){return this._widget.options.sortMethod?typeof this._widget.options.sortMethod=='function'?this._widget.options.sortMethod:B[this._widget.options.sortMethod]:null},prepareGroup:function(a,b){b=b||u;if(!this._groups.containsKey(b)){this._groups.put(b,{startIndex:-1,count:0,'selected':{collapsed:false,count:0,listElement:this._createGroupElement(a,b,true),listContainer:this._createGroupContainerElement(a,b,true)},'available':{collapsed:false,count:0,listElement:this._createGroupElement(a,b,false),listContainer:this._createGroupContainerElement(a,b,false)},groupElement:a,optionGroup:b})}},prepareOption:function(a,b){var e;if(a.data('element-index')===q){b=b||u;this._elements.push(e={index:-1,selected:false,filtered:false,listElement:this._createElement(a,b),optionElement:a,optionGroup:b})}else{this._elements[a.data('element-index')].listElement[(a.prop('disabled')?"add":"remove")+"Class"]('ui-state-disabled')}},reIndex:function(){var e=this.getComparator();if(e){var f=this._groups;this._elements.sort(function(a,b){var c=f.get(a.optionGroup).groupElement;var d=f.get(b.optionGroup).groupElement;var g=e(c?c.attr('label'):u,d?d.attr('label'):u);if(g!=0)return g;else return e(a.optionElement.text(),b.optionElement.text())})}this._bufferedMode(true);this._groups.each(function(g,v,l,a){if(!v['available'].listContainer.parents('.multiselect-element-wrapper').length){if(v.groupElement){v.groupElement.data('option-group',g)}var b=$('<div></div>').addClass('multiselect-element-wrapper').data('option-group',g);var c=$('<div></div>').addClass('multiselect-element-wrapper').data('option-group',g);b.append(v.selected.listElement.hide());if(g!=u||(g==u&&a)){c.append(v['available'].listElement.show())}b.append(v['selected'].listContainer);c.append(v['available'].listContainer);l['selected'].append(b);l['available'].append(c)}v.count=0},this._listContainers,this._widget.options.showDefaultGroupHeader);for(var i=0,eData,gData,len=this._elements.length;i<len;i++){eData=this._elements[i];gData=this._groups.get(eData.optionGroup);if(gData.startIndex==-1||gData.startIndex>=i){gData.startIndex=i;gData.count=1}else{gData.count++}eData.listElement.data('element-index',eData.index=i);if(eData.optionElement.data('element-index')==q||eData.selected!=eData.optionElement.prop('selected')){eData.selected=eData.optionElement.prop('selected');eData.optionElement.data('element-index',i);this._appendToList(eData)}}this._updateGroupElements();this._widget._updateHeaders();this._groups.each(function(g,v,t){t._reorderSelected(g)},this);this._bufferedMode(false)},filter:function(a,b){if(a&&!b){var c={text:a};if(this._widget._triggerUIEvent(A,c)){a=c.text}else{return}}this._bufferedMode(true);var d=this._widget.options.filterSelected;a=(''+a).toLowerCase();if(a.length==0){a=false}for(var i=0,eData,len=this._elements.length,filtered;i<len;i++){eData=this._elements[i];filtered=!(!a||(eData.optionElement.text().toLowerCase().indexOf(a)>-1));if((!eData.selected||d)&&(eData.filtered!=filtered)){eData.listElement[filtered?'hide':'show']();eData.filtered=filtered}else if(eData.selected){eData.filtered=false}}this._widget._updateHeaders();this._bufferedMode(false)},getSelectionInfo:function(){var a={'selected':{'total':0,'count':0,'filtered':0},'available':{'total':0,'count':0,'filtered':0}};for(var i=0,len=this._elements.length;i<len;i++){var b=this._elements[i];a[b.selected?'selected':'available'][b.filtered?'filtered':'count']++;a[b.selected?'selected':'available'].total++}return a},setSelected:function(a,b,c){if(a.optionElement.attr('disabled')&&b){return}a.optionElement.prop('selected',a.selected=b);this._appendToList(a);if(!c){if(this._widget.options.sortable&&b){this._reorderSelected(a.optionGroup)}this._updateGroupElements(this._groups.get(a.optionGroup));this._widget._updateHeaders();this._widget._triggerUIEvent(z,{optionElements:[a.optionElement[0]],selected:b})}},setSelectedAll:function(a){var b=[];var c={};this._bufferedMode(true);for(var i=0,eData,len=this._elements.length;i<len;i++){eData=this._elements[i];if(!((eData.selected==a)||(eData.optionElement.attr('disabled')||(a&&(eData.filtered||eData.selected))))){this.setSelected(eData,a,true);b.push(eData.optionElement[0]);c[eData.optionGroup]=true}}if(this._widget.options.sortable&&a){var d=this;$.each(c,function(g){d._reorderSelected(g)})}this._updateGroupElements();this._widget._updateHeaders();this._bufferedMode(false);this._widget._triggerUIEvent(z,{optionElements:b,selected:a})}};function _(p){var a=$.uix.multiselect.i18n[p.locale]?p.locale:'';var b=$.uix.multiselect.i18n[a];var c=p.plural||0;var d=p.data||{};var t;if(c==2&&b[p.key+'_plural_two']){t=b[p.key+'_plural_two']}else if((c==2||c==3)&&b[p.key+'_plural_few']){t=b[p.key+'_plural_few']}else if(c>1&&b[p.key+'_plural']){t=b[p.key+'_plural']}else if(c==0&&b[p.key+'_nil']){t=b[p.key+'_nil']}else{t=b[p.key]||''}return t.replace(/\{([^\}]+)\}/g,function(m,n){return d[n]})};$.uix.multiselect.i18n={'':{itemsSelected_nil:'no selected option',itemsSelected:'{count} selected option',itemsSelected_plural:'{count} selected options',itemsAvailable_nil:'no item available',itemsAvailable:'{count} available option',itemsAvailable_plural:'{count} available options',itemsFiltered_nil:'no option filtered',itemsFiltered:'{count} option filtered',itemsFiltered_plural:'{count} options filtered',selectAll:'Select All',deselectAll:'Deselect All',search:'Search Options',collapseGroup:'Collapse Group',expandGroup:'Expand Group',selectAllGroup:'Select All Group',deselectAllGroup:'Deselect All Group'}}})(jQuery);
